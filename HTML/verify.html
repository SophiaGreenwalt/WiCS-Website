<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Page Title</title>
    <link rel="stylesheet" href="./style/styleverify.css">
</head>
<body>
    <!-- Navbar -->
  <script id="replace_with_navbar" src="nav.js"></script>

    <!-- Main Content -->
    <form action="verify-code" method="post">

        <div class="explain">
            <p>Enter the code sent to your email.</p>
        </div>
      
        <div class="container">
          <label for="code"><b>Verification Code</b></label>
          <input id="code" placeholder="Enter Verification Code" name="code" required>
      
          <button id="verifyButton">Verify</button>
          <p id="message"></p>
          
        </div>
      </form> 

    <!-- Send to back -->
    <script>
      // Getting the DOM elements
      const codeInput = document.getElementById("code");
      const verifyButton = document.getElementById("verifyButton");
      const messageElement = document.getElementById("message");
      const email = localStorage.getItem("email")

      // Function to handle code verification
      async function handleVerify() {
          const code = codeInput.value;

          // Basic validation to check if the code is provided
          if (!code) {
              messageElement.textContent = "Please enter the verification code.";
              return;
          }

          verifyButton.disabled = true; // Disable the button while processing
          messageElement.textContent = "Verifying..."; // Show loading message

          try {
              // Send verification code to the backend
              const response = await fetch("http://104.201.205.11:5000/api/auth/verify-email", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ email, verificationCode: code }),
              });

              const data = await response.json();
              messageElement.textContent = data.message;

              if (response.ok) {
                  window.location.href = "homepage.html"; // Redirect after successful verification
                  localStorage.setItem("loggedIn", "true")
              }
          } catch (error) {
              messageElement.textContent = "Verification failed. Please try again.";
          } finally {
              verifyButton.disabled = false; // Re-enable the button after processing
          }
      }

      // Attach event listener to the verify button
      verifyButton.addEventListener("click", handleVerify);
  </script>

<!-- Footer -->
<div class="footer">
    <footer>
      <p>Â© 2025 Women in Computer Science Club. All rights reserved.</p>
    </footer>  
</div>

</body>
</html>